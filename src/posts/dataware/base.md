---
icon: mdi:database
title: 数据仓库面试题
date: 2025-11-09
category:
  - dataware
tag:
  - 数据仓库
  - 面试题
---

::: tip 面试建议
数据仓库的面试题，大家一定要本着理解的力度去学习，背下来是没太大用的，随时会被压力。数仓本身没什么太多的技术性，哪怕是在具体工作中，其实按照规范的也不多。但是面试的时候，如果你理解不透彻，经常会被压力到,往往会顺着业务去挖掘数仓建模在你的实际落地是如何使用的。
:::

## 面向主题的、集成的、相对稳定的、反应历史变化的数据集合，用于决策分析。

## 数据仓库设计

### 数据仓库分为几层？各自有什么作用？<Badge text="高" type="tip" /><Badge text="美团" type="info" />
<img :src="$withBase('/images/dw_4level.png')" alt="数仓分层" style="width: 60%; height: auto;"/>

- 数据引入层ODS（Operation Data Store）：存放**未经过处理**的原始数据至数据仓库系统，结构上与源系统保持一致，是数据仓库的数据准备区。主要完成基础数据引入到MaxCompute的职责，同时记录基础数据的历史变化。
- 数据公共层CDM（Common Data Model，又称通用数据模型层），包括DIM维度表、DWD和DWS，由ODS层数据加工而成。主要完成数据加工与整合，建立一致性的维度，构建可复用的面向分析和统计的明细事实表，以及汇总公共粒度的指标。
- 公共维度层（DIM）：基于维度建模理念思想，建立整个企业的一致性维度。降低数据计算口径和算法不统一风险。

- 公共汇总粒度事实层（DWS）：以分析的**主题对象**作为建模驱动，基于上层的应用和产品的指标需求，构建公共粒度的**汇总指标事实表**，以**宽表**化手段物理化模型。构建命名规范、口径一致的统计指标，为上层提供公共指标，建立汇总宽表。公共汇总粒度事实层的表通常也被称为汇总逻辑表，用于存放派生指标数据。

- 明细粒度事实层（DWD）：以业务过程作为建模驱动，基于每个具体的业务过程特点，构建最细粒度的明细层事实表。可以结合企业的数据使用特点，将明细事实表的某些重要维度属性字段做适当冗余，即宽表化处理。

- 数据应用层ADS（Application Data Service）：存放数据产品个性化的统计指标数据。根据CDM与ODS层加工生成。
::: note
人话版本：ods就是原始数据，怎么来的怎么放；dwd是最后的d是detail，放最细粒度的业务数据，比如小王在A时间加购了商品B；dim层就是维度层，类似于我们范式建模，小王的信息算维度，商品的信息算维度，甚至时间的信息（是不是工作日，节假期等）；dws是基于dwd的汇总，以及基于dim的膨胀加宽，比如小王在一天加购了多少商品，支付了多少商品，花了多少钱；ads层就是个性化的统计指标了，比如今天所有用户的从加购到支付的转化率。
:::

### 如果去掉DWS层可以吗？有什么坏处？(成丰货运)<Badge text="中" type="tip" /><Badge text="成丰货运" type="info" />
从整体上看，数据仓库的分层设计主要目的是解耦与复用。其中，复用的作用在 DWS（Data Warehouse Summary，公共汇总层） 层体现得尤为明显。在这一层，会沉淀大量可复用的**派生指标和中间汇总数据**，供上层 ADS（Application Data Service，数据应用层） 等业务层使用。ADS 层通常面向具体的产品或业务场景，而不同产品的指标口径往往需要保持一致，也需要快速产出。因此，DWS 层承担了指标统一与复用的中枢作用，确保各业务口径一致、开发效率高、维护成本低。举个例子：DWS出的是每日每用户的支付订单数，支付金额，是否新用户等；ADS出的就是今日支付总额，今日支付总订单数，今日新用户支付转化率等。坏处自然就是没了DWS层，容易导致ADS层指标口径不一致，且计算复杂度增加。

### 事实表分为几类，有什么区别？

- 事务事实表：事实表中一行对应空间或时间上某点的度量事件，也就是该业务的原子性事务力度，比如用户的购买记录。
- 周期快照事实表：事实表的一行对应的是某一个标准周期，比如某一天，某一年的度量事件，相比较事务型，他的粒度是周期性的，而不是个体的。
- 累计快照事实表：事实表的一行对应的是发生在过程开始和结束之间可以预测的步骤内的度量事件，比如用户的下单到收获的全链路，下单之后填充下单时间，快递发出之后填包裹时间，派送填充。。。，相比较前两个，这个是更具动态性的。

### 退化维度指的是什么？
有时维度中除了主键外没有其他内容，没有新开一张表。也就是虽然它表现为一个维度属性，但并没有单独建立对应的维度表，而是直接存储在事实表中的维度字段。比如发票号，交易号等，这些号码本身是没有描述信息的，他背后的订单信息本身就是存储在事实表中。

### 如何处理缓慢维度变化？

首先介绍一下什么是缓慢维度变化(slowly changing dimension,SCD)，指的是维度表中的属性变化频率低，这有什么问题呢？比如产品维度表中某个产品id对应的产品线和部门发生了变化，如果我直接用最新的该产品线和部门进行匹配，会导致匹配不到旧的数据。为了解决这个问题呢，有下面几种办法：
1. 原样保留，也就是不动
2. 覆盖重写，直接覆盖掉，忽略旧数据
3. 增加新行，不改变原来的数据，增加一行新的数据
4. 增加新属性，将改变后的值作为一个新列
5. 拉链表，也是增加新行，但是多两个属性值，也就是该列的有效起止时间，最新的比如9999-12-31，当有变化的时候，上一条的结束日期更新为修改时间，增加的新行开始日期为修改时间，结束时间为9999-12-31

### 维度建模和范式建模？<Badge text="中" type="tip" /><Badge text="美团" type="info" />
范式建模需要遵守最基本的3NF范式，从而消除数据冗余，将数据划分为不同的实体，每个实体构成一个关系表，有时候称为实体-关系模型（可以用ER图表示交互关系）。然而，想要挖掘远距离的实体关系，往往联立多种关系，难以理解和检索，同时大量数据会带来查询性能的问题。为了解决**查询复杂、理解复杂**的问题，引入了维度建模，其本质上是宽约束的范式建模，允许数据冗余，用空间来换时间。最后来说维度建模是什么，维度建模是以业务视角去串联数据，不严格要求范式，以**事实表+维度表**的形式来让数据组织起来，其中事实表是发生的事情，而维度表是事情的描述背景。举个栗子来说明：

#### 范式建模的设计

| （user表）user_id | user_name | gender | province_id |
| ------- | --------- | ------ | ----------- |
| U001    | 张三        | 男      | P01         |

| （province省份表）province_id | province_name |
| ----------- | ------------- |
| P01         | 上海市           |

| （订单表）order_id | user_id | product_id | order_date | order_amt |
| -------- | ------- | ---------- | ---------- | --------- |
| O1001    | U001    | SKU001     | 2025-11-09 | 6999.00   |
- 如果想要统计每个省份的订单金额？
  
```ts title="范式建模"
SELECT 
  p.province_name,
  SUM(o.order_amt) AS total_amt
FROM order o
JOIN user u ON o.user_id = u.user_id
JOIN province p ON u.province_id = p.province_id
GROUP BY p.province_name;
```

#### 维度建模的设计

|（购买事实表fact） order_id | user_key | product_key | province_key | date_key | order_amt |
| -------- | -------- | ----------- | ------------ | -------- | --------- |
| O1001    | U001     | SKU001      | P01          | 20251109 | 6999.00   |

| （省份维度表dim_province）province_key | province_name | region |
| ------------ | ------------- | ------ |
| P01          | 上海市           | 华东     |


```ts title="维度建模"
SELECT 
  p.province_name,
  SUM(f.order_amt) AS total_amt
FROM fact_order f
JOIN dim_province p ON f.province_key = p.province_key
GROUP BY p.province_name;
```

可以看到在范式建模中，省份的key是可以通过user信息来获取的，为了避免数据冗余以及三范式中的传递依赖，因而并不会存放在订单表中，而**订单表也仅仅是数据存储的作用**，保证的是数据一致性和完整性；而在维度建模中，为了减少数据查询的复杂性，将省份的key同样放在购买明细表中，最关键的是**事实表表示的是一条业务过程，是以业务分析为核心**，旨在结构清晰，易于理解，所以事实表是灵活的，业务驱动的。

### 维度建模有几种模型？<Badge text="中" type="tip" /><Badge text="美团" type="info" />
1. 星型模型（最常用）：由事实表+维度表构成，一条事实记录，比如王三在2025年11月10日购买了一条红色的裤子，花费了52美元。而维度呢，就是王三的个人信息、当日的属性（节假日、双十一等）、红色裤子对应的SKU的信息（尺寸、产地等）、美元的属性（汇率等）。就像是一颗星星，中间是事实表，挂载着各种维度。
<img :src="$withBase('/images/star_model.png')" alt="数仓分层" style="width: 30%; height: auto;"/>
2. 雪花模型（Kimball不推荐）：是在星型模型的基础上，**维度表规范化**，拆成多层子表，比如上面的用户维度表中，里面会存储王三的城市、国家、国家位于哪个大洲，而雪花模型呢，则会只存储城市，用城市和国家的关系表再去关联出来国家的信息。整体就是一个事实表+维度表+维度表的维度表...，像是一个雪花一样，维度还有细小的膨胀维度。
3. 星座模型：指的是多个事实表共享特定的一些维度表，比如销售的事实表和库存的事实表，共享产品维度表，日期维度表等维度，就像是一堆星星形成的星座，企业级数仓中较为常见，主要是用来跨主题形成一致的维度。

### 数仓的主题域和数据域有什么区别？
- 主题域是面向业务分析的，自上而下的。比如以贷款为例，在主题域下就是风控、营销活动等。
- 数据域是对数据本身的归类，自下而上的，比如还是以贷款为例，在数据域下面就是贷前，贷中，贷后，实际上是对数据本身的划分，没有业务分析视角。

::: tip 实际体验
数仓划分主题域和数据域都是比较灵活的，一般而言呢，我们可以按照部门划分数据域，将数据在逻辑上区分；在数仓内部按照业务系统划分主题域。也可以借鉴行业内的案例，比如电商比较流行的商品、支付等。
:::

### 数仓中的总线矩阵指的是什么？维度冗余是怎么处理的？<Badge text="中" type="tip" /><Badge text="携程" type="info" />
<img :src="$withBase('/images/zongxianjuzhen.png')" alt="总线矩阵" style="width: 100%; height: auto;"/>

总线矩阵中横坐标是不同的维度，纵坐标指的是业务过程、主题。主要是用来组织和管理维度模型的。维度冗余指的是在多个事实表中存储了大量重复的维度，比如销售主题事实表存储了客户维度属性值，购物车主题也存储了客户维度属性值，这里指的不是连接键，而是维度的其他属性，相当于存储了多份额外的维度属性值。其实每次需要的时候进行通用共享维度关联就可以了，没必要每个事实表都进行扩充。


## 指标建设

### 指标分为几类，有什么区别？<Badge text="低" type="tip" />
先介绍几个前置概念，分别是原子指标，修饰词，时间周期。
- 原子指标：统计的是细粒度下的明确业务的统计口径和计算逻辑，最小度量单元，不可再分。比如业务为购买，原子指标就是支付金额。
- 修饰词：指的是数据域中的不同维度的修饰，比如京海市可口可乐的销售金额，那么京海市和可口可乐都是修饰词。
- 时间周期：主要是明确统计的时间范围/窗口，比如近一个月的京海市可口可乐的销售金额，那么近一个月就是时间周期。
> 了解了前置概念，下面介绍这三种指标：

<img :src="$withBase('/images/zhibiao_ali.png')" alt="指标建设" style="width: 80%; height: auto;"/>

1. 原子指标：上述介绍过，就是最细粒度的口径描述
2. 派生指标：原子指标 **+** 时间周期 **+** N修饰词
3. 复核指标：由一个或者多个派生指标或复合指标构成，用于复杂的分析型指标，比如今年手机端的客单价，就是今年总额/今年总人数（两个派生）。

## 数据治理

### 如何保证数据质量？

这是一个很大的问题，主要是去多方面分析问题：

> 数据质量往往体现在准确性，完整性，一致性，时效性，唯一性，可靠性，可访问性，可理解性。

1. 数据采集环节：管理数据源，保证来源可靠，对数据接入进行规则校验，比如数据范围、类型等。
2. 数据预处理环节：去重采集中产生的重复数据，视情况填补缺失值，进行错误数据纠正
3. 数据标准化环节：构建统一的编码规范，比如命名，生命周期，上下线等，对于元数据进行记录。
4. 数据监控环节：通过自动化告警以及日志记录，还有AI分析等实现数据监控。