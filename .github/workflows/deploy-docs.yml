name: 部署文档

on:
  push:
    branches:
      - main

permissions:
  contents: write   # 允许写 gh-pages 或你的目标分支

jobs:
  deploy-gh-pages:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          # submodules: true    # 如需要子模块再打开

      - name: 设置 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20       # 建议用 LTS 稳定版；你要用 22 也可
          cache: npm

      - name: 安装依赖
        run: |
          corepack enable
          npm ci

      - name: 构建文档
        env:
          NODE_OPTIONS: --max_old_space_size=8192
        run: |
          npm run docs:build
          > src/.vuepress/dist/.nojekyll

      - name: 部署文档
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          # 如果你已经创建了 ACCESS_TOKEN（classic/FGPAT），用它；否则用默认 GITHUB_TOKEN 也行。
          token: ${{ secrets.ACCESS_TOKEN || secrets.GITHUB_TOKEN }}
          branch: blog_pages                 # 目标分支（和你仓库 Pages 设置匹配）
          folder: src/.vuepress/dist         # 构建产物目录
          clean: true                        # 可选：部署前清理目标分支
          single-commit: true                # 可选：历史压缩成一个提交
